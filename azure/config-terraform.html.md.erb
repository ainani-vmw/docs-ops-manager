---
title: Configuring BOSH Director on Azure using Terraform
owner: Ops Manager
iaas: Azure
install_type: terraform
---

After you deploy <%= vars.ops_manager_first %> to Azure, follow the steps in this topic to configure the
BOSH Director tile within <%= vars.ops_manager %> on Azure.
For information about deploying <%= vars.ops_manager %> to Azure,
see [Deploying <%= vars.ops_manager %> to Azure](prepare-env-terraform.html).

<%= partial "/pcf/warning-terraform" %>

<p> You can also use the procedures in this topic for the <%= vars.ops_manager %> API.
For more information, see <a href="../install/ops-man-api.html">Using the <%= vars.ops_manager %> API</a>.</p>

## <a id='prerequisites'></a> Prerequisite

To complete the procedures in this topic, you must have access to the output generated when you ran `terraform apply` to create resources for this deployment. To view this output, run `terraform output` in the directory where you ran `terraform apply`. You use the values in this output to configure the BOSH Director tile.

## <a id='access-om'></a> Step 1: Log into <%= vars.ops_manager %>

1. In a web browser, go to the fully qualified domain name (FQDN) of <%= vars.ops_manager %>. Use the `ops_manager_dns` value from running `terraform output`.

1. Log in to <%= vars.ops_manager %>. To log in, see [Log in to <%= vars.ops_manager %> For the First Time](../login.html#login-first-time).

## <a id='azure-config'></a> Step 2: Azure Config page

1. Click the **BOSH Director** tile.

1. Click **Azure Config**.

    ![alt-text=""](../common/images/azure/azure-config.png)

1. Complete the following fields with information you obtained in [Preparing to deploy <%= vars.ops_manager %> on Azure Using Terraform](prepare-azure-terraform.html).
	* **Subscription ID**: Enter the ID of your Azure subscription.
	* **Tenant ID**: Enter your `TENANT_ID`.
	* **Application ID**: Enter the `APPLICATION_ID` that you created in [Step 3: Create an AAD application](prepare-azure-terraform.html#create-aad) in _Preparing to Deploy <%= vars.ops_manager %> on Azure Using Terraform_.
	* **Client Secret**: Enter your `CLIENT_SECRET`.

2. Complete the following fields:
	* **Resource Group Name**: Enter the name of your resource group, which is exported from Terraform as the output `pcf_resource_group_name`.
	* **BOSH Storage Account Name**: Enter the name of your storage account, which is exported from Terraform as the output `bosh_root_storage_account`.

3. For **Cloud Storage Type**, click **Use Managed Disks**. For **Storage Account Type**, click **Premium_LRS** which corresponds to SSD-based storage. For more information, see [Azure Managed Disks Overview](https://docs.microsoft.com/en-us/azure/storage/storage-managed-disks-overview) in the Microsoft documentation for more information.

    ![alt-text=""](../common/images/azure/azure-managed-disk.png)

    <p> You can update your deployment from using storage accounts to using managed disks. However,
    after you click <strong>Use Managed Disks</strong> and deploy <%= vars.ops_manager %>, you cannot change your deployment back to use storage accounts.</p>

1. For **Default Security Group**, enter the `bosh_deployed_vms_security_group_name` output from Terraform.

2. For **SSH Public Key**, enter the `ops_manager_ssh_public_key` output from Terraform.

3. For **SSH Private Key**, enter the `ops_manager_ssh_private_key` output from Terraform.

4. For **Availability Mode**, choose whether to use **Availability Sets** or **Availability Zones**. You can further configure this option in the [**Assign AZs and Networks Page**](#assign-networks).
   * **For new installations of <%= vars.ops_manager %>**: **Availability Zones** are selected by default, but you can click **Availability Sets**.
   * **If you are upgrading from v2.4**: You must use **Availability Sets**.
    <p> You can only choose between Availability Zones and Availability Sets in a staged BOSH Director tile
    that has not yet deployed. After you click <strong>Apply Changes</strong> and the BOSH Director deploys successfully, you cannot switch between Availability Zones and Availability Sets.</p>

<%= partial "../common/azure-environment" %>

10. Click **Save**.


## <a id='director-config'></a> Step 3: Director Config page

<%= partial "../common/director-config" %>

## <a id='network'></a> Step 4: Create Networks page

Click **Create Networks** and follow the procedures in this section to add the network configuration that you created for your VPC.

* [Create Network for <%= vars.app_runtime_abbr %>](#pas-network)
* [Create Network for <%= vars.k8s_runtime_abbr %>](#pks-network)

### <a id='pas-network'></a> Create network for <%= vars.app_runtime_abbr %>

Create the following networks:

* [<%= vars.app_runtime_abbr %> Infrastructure network](#pas-infrastructure-network)
* [<%= vars.app_runtime_abbr %> Runtime network](#pas-runtime-network)
* [<%= vars.app_runtime_abbr %> Services network](#pas-services-network)

<p> The Azure portal sometimes displays the names of resources with incorrect capitalization. Always use the
Azure CLI to retrieve the correctly capitalized name of a resource.</p>

#### <a id='pas-infrastructure-network'></a> <%= vars.app_runtime_abbr %> infrastructure network

To create the infrastructure network:

1. (Optional) Click **Enable ICMP checks** to enable ICMP on your networks. <%= vars.ops_manager %> uses ICMP checks to confirm that components within your network are reachable.

1. Click **Add Network**.

1. In the **Name** text box, enter `infrastructure`.

1. Under **Subnets**, create a subnet using the information in the following table:

    <table class=“table”>
    <thead>
      <tr>
        <th>Name</th>
        <td><code>infrastructure</code></td>
      </tr>
      </thead>
      <tr>
        <th>Azure network name</th>
        <td>Enter <code>NETWORK-NAME/SUBNET-NAME</code>, where:
          <ul>
            <li><code>NETWORK-NAME</code> is the <code>network_name</code> output from
            Terraform</li>
            <li><code>SUBNET-NAME</code> is the <code>infrastructure_subnet_name</code> output from
            Terraform</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th>CIDR</th>
        <td>Enter the CIDR listed under <code>infrastructure_subnet_cidrs</code> output from
        Terraform. For example, <code>10.0.8.0/26</code>.</td>
      </tr>
      <tr>
        <th>Reserved IP ranges</th>
        <td>Enter the first nine IP addresses of the subnet. For example,
        <code>10.0.8.1-10.0.8.9</code>.</td>
      </tr>
      <tr>
        <th>DNS</th>
        <td>Enter <code>168.63.129.16</code>.</td>
      </tr>
      <tr>
        <th>Gateway</th>
        <td>Enter the first IP address of the subnet. For example, <code>10.0.8.1</code>.</td>
      </tr>
    </table>

    ![alt-text="The Create Networks page contains two sections: Verification Settings and Networks."](../common/images/azure/create-networks-management.png)

1. Click **Save**.<%= vars.expand_network_azs %>

#### <a id='pas-runtime-network'></a> <%= vars.app_runtime_abbr %> runtime network

1. Click **Add Network**.

1. In the **Name** text box, enter `pas`.

1. Under **Subnets**, create a subnet using the information in the following table:

    <table class=“table”>
    <thead>
      <tr>
        <th>Name</th>
        <td><code>pas</code></td>
      </tr>
      </thead>
      <tr>
        <th>Azure network name</th>
        <td>Enter <code>NETWORK-NAME/SUBNET-NAME</code>, where:
          <ul>
            <li><code>NETWORK-NAME</code> is the <code>network_name</code> output from
            Terraform</li>
            <li><code>SUBNET-NAME</code> is the <code>pas_subnet_name</code> output from
            Terraform</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th>CIDR</th>
        <td>Enter the CIDR listed under <code>pas_subnet_cidrs</code> output from Terraform. For
        example, <code>10.0.0.0/22</code>.</td>
      </tr>
      <tr>
        <th>Reserved IP ranges</th>
        <td>Enter the first nine IP addresses of the subnet. For example,
        <code>10.0.0.1-10.0.0.9</code>.</td>
      </tr>
      <tr>
        <th>DNS</th>
        <td>Enter <code>168.63.129.16</code>.</td>
      </tr>
      <tr>
        <th>Gateway</th>
        <td>Enter the first IP address of the subnet. For example, <code>10.0.0.1</code>.</td>
      </tr>
    </table>

    ![alt-text=""](../common/images/azure/create-networks-deployment.png)

1. Click **Save**.

#### <a id='pas-services-network'></a> <%= vars.app_runtime_abbr %> services network

1. Click **Add Network**.

1. In the **Name** text box, enter `services`.

1. Under **Subnets**, create a subnet using the information in the following table:

    <table class=“table”>
    <thead>
      <tr>
        <th>Name</th>
        <td><code>services</code></td>
      </tr>
      </thead>
      <tr>
        <th>Azure network name</th>
        <td>Enter <code>NETWORK-NAME/SUBNET-NAME</code>, where:
          <ul>
            <li><code>NETWORK-NAME</code> is the <code>network_name</code> output from
            Terraform</li>
            <li><code>SUBNET-NAME</code> is the <code>services_subnet_name</code> output from
            Terraform</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th>CIDR</th>
        <td>Enter the CIDR listed under <code>services_subnet_cidrs</code> output from Terraform.
        For example, <code>10.0.4.0/22</code>.</td>
      </tr>
      <tr>
        <th>Reserved IP ranges</th>
        <td>Enter the first nine IP addresses of the subnet. For example,
        <code>10.0.4.1-10.0.4.9</code>.</td>
      </tr>
      <tr>
        <th>DNS</th>
        <td>Enter <code>168.63.129.16</code>.</td>
      </tr>
      <tr>
        <th>Gateway</th>
        <td>Enter the first IP address of the subnet. For example, <code>10.0.4.1</code>.</td>
      </tr>
    </table>

    ![alt-text="Create a subnet."](../common/images/azure/create-networks-services.png)

1. Click **Save**.

2. You might see red warnings. Ignore them only if **Enable ICMP checks** is not selected.

If you complete this step for <%= vars.app_runtime_abbr %>, go to [Assign AZs and Networks page](#assign-networks).

### <a id='pks-network'></a> Create network for <%= vars.k8s_runtime_abbr %>

Create the following three networks:

* [<%= vars.k8s_runtime_abbr %> Infrastructure network](#pks-infrastructure-network)
* [<%= vars.k8s_runtime_abbr %> Runtime network](#pks-runtime-network)
* [<%= vars.k8s_runtime_abbr %> Services network](#pks-services-network)

<p> The Azure portal sometimes displays the names of resources with incorrect capitalization. Always use the
Azure CLI to retrieve the correctly capitalized name of a resource.</p>

#### <a id='pks-infrastructure-network'></a> <%= vars.k8s_runtime_abbr %> infrastructure network

To create the infrastructure network:

1. (Optional) Click **Enable ICMP checks** to enable ICMP on your networks. <%= vars.ops_manager %> uses ICMP checks to confirm that components within your network are reachable.

1. Click **Add Network**.

1. In the **Name** text box, enter `infrastructure`.

1. Under **Subnets**, create a subnet using the information in the following table:

    <table class=“table”>
    <thead>
      <tr>
        <th>Name</th>
        <td><code>infrastructure</code></td>
      </tr>
      </thead>
      <tr>
        <th>Azure network name</th>
        <td>Enter <code>NETWORK-NAME/SUBNET-NAME</code>, where:
          <ul>
            <li><code>NETWORK-NAME</code> is the <code>network_name</code> output from
            Terraform</li>
            <li><code>SUBNET-NAME</code> is the <code>infrastructure_subnet_name</code> output from
            Terraform</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th>CIDR</th>
        <td>Enter the CIDR listed under <code>infrastructure_subnet_cidrs</code> output from
        Terraform. For example, <code>10.0.8.0/26</code>.</td>
      </tr>
      <tr>
        <th>Reserved IP ranges</th>
        <td>Enter the first nine IP addresses of the subnet. For example,
        <code>10.0.8.1-10.0.8.9</code>.</td>
      </tr>
      <tr>
        <th>DNS</th>
        <td>Enter <code>168.63.129.16</code>.</td>
      </tr>
      <tr>
        <th>Gateway</th>
        <td>Enter the first IP address of the subnet. For example, <code>10.0.8.1</code>.</td>
      </tr>
    </table>

1. Click **Save**.

#### <a id='pks-runtime-network'></a> <%= vars.k8s_runtime_abbr %> runtime network

1. Click **Add Network**.

1. In the **Name** text box, enter `pks`.

1. Under **Subnets**, create a subnet using the information in the following table:

    <table class=“table”>
    <thead>
      <tr>
        <th>Name</th>
        <td><code>pks</code></td>
      </tr>
      </thead>
      <tr>
        <th>Azure network name</th>
        <td>Enter <code>NETWORK-NAME/SUBNET-NAME</code>, where:
          <ul>
            <li><code>NETWORK-NAME</code> is the <code>network_name</code> output from
            Terraform</li>
            <li><code>SUBNET-NAME</code> is the <code>pks_subnet_name</code> output from
            Terraform</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th>CIDR</th>
        <td>Enter the CIDR listed under <code>pks_subnet_cidrs</code> output from Terraform. For
        example, <code>10.0.12.0/22</code>.</td>
      </tr>
      <tr>
        <th>Reserved IP ranges</th>
        <td>Enter the first nine IP addresses of the subnet. For example,
        <code>10.0.12.1-10.0.12.9</code>.</td>
      </tr>
      <tr>
        <th>DNS</th>
        <td>Enter <code>168.63.129.16</code>.</td>
      </tr>
      <tr>
        <th>Gateway</th>
        <td>Enter the IP address listed under <code>pks_subnet_gateway</code> output from
        Terraform. This should be the first IP address of the subnet. For example,
        <code>10.0.12.1</code>.</td>
      </tr>
    </table>

1. Click **Save**.

### <a id='pks-services-network'></a> <%= vars.k8s_runtime_abbr %> services network

1. Click **Add Network**.

1. In the **Name** text box, enter `services`.

1. Under **Subnets**, create a subnet using the information in the following table:

    <table class=“table”>
    <thead>
      <tr>
        <th>Name</th>
        <td><code>services</code></td>
      </tr>
      </thead>
      <tr>
        <th>Azure network name</th>
        <td>Enter <code>NETWORK-NAME/SUBNET-NAME</code>, where:
          <ul>
            <li><code>NETWORK-NAME</code> is the <code>network_name</code> output from
            Terraform</li>
            <li><code>SUBNET-NAME</code> is the <code>services_subnet_name</code> output from
            Terraform</li>
          </ul>
        </td>
      </tr>
      <tr>
        <th>CIDR</th>
        <td>Enter the CIDR listed under <code>services_subnet_cidrs</code> output from Terraform.
        For example, <code>10.0.16.0/22</code>.</td>
      </tr>
      <tr>
        <th>Reserved IP ranges</th>
        <td>Enter the first nine IP addresses of the subnet. For example,
        <code>10.0.16.1-10.0.16.9</code>.</td>
      </tr>
      <tr>
        <th>DNS</th>
        <td>Enter <code>168.63.129.16</code>.</td>
      </tr>
      <tr>
        <th>Gateway</th>
        <td>Enter the IP address listed under <code>services_subnet_gateway</code> output from
        Terraform. This must the first IP address of the subnet. For example,
        <code>10.0.16.1</code>.</td>
      </tr>
    </table>

1. Click **Save**.

1. You might see red warnings.
   Ignore them only if **Enable ICMP checks** is not selected.


## <a id='assign-networks'></a> Step 5: Assign AZs and Networks page

<ol>
  <li>Click <strong>Assign AZs and Networks</strong>.<br/>
  <p> The appearance of this page changes based on whether you are using Availability Zones or Availability Sets. For more information, see <a href="#azure-config">Step 2: Azure Config Page</a>.</p>
    <ul>
    <li>If you use Availability Zones, click one of the three available zones from the <strong>Singleton Availability Zone</strong> dropdown, then click a network from the <strong>Networks</strong> dropdown. The networks that appear in this list are networks that you created earlier in this procedure.
    </li>
    <li>If you use Availability Sets, click a network from the <strong>Networks</strong> drop-down menu. The networks that appear in this list are networks you created earlier in this procedure.</li>
    </ul>
  </li>
  <li>Click <strong>Save</strong>.</li>
</ol>


## <a id='security'></a> Step 6: Security page

<%= partial "../common/security-pane" %>

## <a id='bosh-dns'></a> Step 7: BOSH DNS Config page

<%= partial '../common/bosh-dns-config'  %>

## <a id='syslog'></a> Step 8: Syslog page

<%= partial "/pcf/ops-manager/syslog_bosh", :locals => { :syslog_context => 'BOSH Director' } %>

## <a id='resource-config'></a> Step 9: Resource Config page

1. Click **Resource Config**.

    ![alt-text="The BOSH DNS Config page has three text boxes: Excluded Recursors, Recursor Timeout, and Handlers."](../common/images/azure/om-resource-config.png)

1. Under the **Instances**, **VM Type**, and **Persistent Disk Type** text boxes, click **Automatic** from the drop-down menu to allocate the recommended resources for the job. If the **Persistent Disk Type** field reads **None**, the job does not require persistent disk space.

    <p> For the BOSH Director job, click a VM type with at least 8&nbsp;GB memory.</p>
    <p> If you set a field to <strong>Automatic</strong> and the recommended resource allocation changes in a future version, <%= vars.ops_manager %> automatically uses the new recommended allocation.</p>
    <p> If you install <%= vars.windows_runtime_first %>,
    provision your <strong>Main Compilation Job</strong> with at least 100&nbsp;GB of disk space.</p>

2. (Optional) To add a load balancer to the BOSH Director, click the icon next to the **BOSH Director** job name to see the **Load Balancers** field and **Internet Connected** check box.
For **Load Balancers**, enter your Azure application gateway name under the **BOSH Director** job.
To create an application gateway, follow the procedures in [Create an application gateway with SSL termination using Azure PowerShell](https://docs.microsoft.com/en-us/azure/application-gateway/application-gateway-ssl-arm) from the Azure documentation. When you create the application gateway, associate the gateway's IP with your system domain.

1. Click **Save**.

## <a id='custom-vm-extensions'></a> Step 10: Add custom VM extensions (optional)

<%= partial "../common/vm-extension-config"  %>

## <a id='complete'></a> Step 11: Complete the BOSH Director installation

1. Click the <%= vars.ops_manager %> Installation Dashboard link to return to the Installation Dashboard.

1. Click **Review Pending Changes** > **Apply Changes**. If the following ICMP error messages appear ("Cannot reach gateway with IP x.x.x.x (ignorable if CMP is deactivated) and Cannot reach DNS with IP x.x.x.x (ignorable if CMP is deactivated)), click **Ignore errors and start the install**.

    ![alt-text=""](../common/images/cloudform/install-error.png)

1. BOSH Director begins the installation. This might take a few moments. When the installation process successfully completes, the **Changes Applied** window appears.

    ![alt-text="BOSH Director installation begins."](../common/images/cloudform/ops-manager-complete.png)


## <a id='next'></a> Next steps

After you have followed this procedure, do one of the following:
<ul>
  <li>If you are deploying <%= vars.app_runtime_abbr %>, follow the procedures in [Configuring <%= vars.app_runtime_abbr %>](https://docs.vmware.com/en/VMware-Tanzu-Application-Service/<%= vars.dot_major_tas_version %>/tas-for-vms/prerequisites.html).</li>
  <li>If you are deploying <%= vars.k8s_runtime_abbr %>, follow the procedures in [Creating Managed Identities in Azure for <%= vars.k8s_runtime_abbr %>](https://docs.vmware.com/en/VMware-Tanzu-Kubernetes-Grid-Integrated-Edition/1.16/tkgi/GUID-azure-managed-identities.html).</li>
</ul>
