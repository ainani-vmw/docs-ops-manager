---
title: Migrating Tanzu Operations Manager to a new datastore in vSphere
owner: Customer0
---

This topic describes how to migrate your <%= vars.ops_manager_first %> installation to a new vSphere datastore.

## <a id='prereqs'></a> Prerequisites

Both the new and existing vSphere datastores must reside in the same data center.

To avoid service disruption, <%= vars.company_name %> recommends that you configure your overall <%= vars.ops_manager %> deployment for high availability (HA). In addition, check for configurations necessary to achieve HA in each of your installed product tiles.

If your environment has any single points of failure, service might be disrupted as a result of the migration.


## <a id='prep'></a> Before you begin

The following sections describe the steps you can do prior to the migration.

### <a id='backup'></a> Step 1: Back up your environment

Ensure that your <%= vars.ops_manager %> environment is fully backed up.

For more information about how to back up <%= vars.ops_manager %>, see [Backing Up Deployments](../../install/backup-restore/index.html).

### <a id='doc'></a> Step 2: Document current environment settings

Document your current environment settings before you proceed with the datastore migration. Record which VMs are running
and in which datastore they reside. If you experience any issues during or after the migration, you must have this
information to restore your environment.

To obtain this information:

1. Run one of these commands:
    * If you use BOSH CLI v2, run:

        ```
        bosh -e BOSH-ENVIRONMENT instances --details > instances.txt
        ```

        Where `BOSH-ENVIRONMENT` is the alias you assigned to your BOSH Director.

    * If you use the original version of the BOSH CLI, run:

        ```
        bosh-old instances --details > instances.txt
        ```

1. Save the resulting `instances.txt` file to a safe location.

1. Note the datastore where each VM resides in vSphere.

### <a id='system_health'></a> Step 3: Check system health

Check the **Status** tab in your runtime product tiles, such as <%= vars.app_runtime_first %> or
<%= vars.k8s_runtime_first %>, and make sure there are no errors or reported issues.

### <a id='tile_heatlh'></a> Step 4: Check installed products health

In each tile installed in your <%= vars.ops_manager %> deployment, check the **Status** tab and verify
there are no errors or reported issues.

### <a id='opsman_health'></a> Step 5: Check BOSH Director status

To check the status of your BOSH Director:

1. Verify that there are no pending changes and that the status of all tiles is green.

1. Verify the last installation log does not contain any errors.

1. Before you proceed with the migration, click **Review Pending Changes** and click **Apply Changes** to make sure there are no errors in the installation log.


## <a id='migrate_proc'></a> Procedure: Migrate <%= vars.ops_manager %> to a new datastore

To migrate your <%= vars.ops_manager %> deployment to a new datastore:

1. Go to the <%= vars.ops_manager %> Installation Dashboard.

1. Click the BOSH Director tile.

1. Click **vCenter Config**.

1. Update the **Ephemeral Datastore Names** and **Persistent Datastore Names** text boxes to reflect the new
datastore names.<br>
If you use the datastore clustering feature in vSphere, provide only the datastore cluster name in the <strong>Persistent Datastore Cluster Names</strong> // <strong>Ephemeral Datastore Cluster Names</strong> fields.

1. Click **Save**.

1. Click **Review Pending Changes**, then deselect the **Select All Products** check box so that
only the BOSH Director tile is still selected.

1. Click **Apply Changes**.

1. Confirm that the BOSH Director VM has persistent disk on the new datastore.
   1. From the vCenter, find the BOSH Director VM.
   2. In the **Related Objects** section, verify the storage has been updated to the new datastore.

2. In the BOSH Director tile, click **Director Config**.

3. Select the **Recreate VMs deployed by the BOSH Director** option.

4. Click **Review Pending Changes**.

5. If you are using any service tiles, select the **Recreate All On-Demand Service Instances** errand for each of the tiles you migrate.

6. Click **Apply Changes**.
