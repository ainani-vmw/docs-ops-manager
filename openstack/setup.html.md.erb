---
title: Deploying Ops Manager on OpenStack
owner: Ops Manager
---



This guide describes how to provision the OpenStack infrastructure where you
need to install [<%= vars.ops_manager %>](https://network.pivotal.io/products/pivotal-cf). Use this topic when [Installing <%= vars.ops_manager %> on OpenStack](../install/openstack.html).

After completing this procedure, complete all of the steps in [Configuring BOSH Director on OpenStack](config.html) and [Configuring <%= vars.app_runtime_abbr %>](https://docs.pivotal.io/application-service/operating/configure-pas.html).

<p class="note"><strong>Note:</strong> This document uses Mirantis OpenStack for screenshots and examples. The screens of your OpenStack vendor configuration interface may differ.</p>


## <a id='log-in'></a> Step 1: Log in to the OpenStack Horizon Dashboard

1. Log in to the OpenStack Horizon dashboard.

    <%= image_tag("../common/images/openstack/log-in.png", :alt => "Login screen shows red and white banner with the 'Mirantis' logo to the left of 'OpenStack Dashboard.'") %>

1. From the OpenStack project list dropdown, set the active project by selecting the project where you deploy <%= vars.ops_manager %>.

    <%= image_tag("../common/images/openstack/project-list.png", :alt => "To the right of the logo, the project dropdown button is red and expanded. A project name is selected with a gray checkmark.") %>


## <a id='security'></a> Step 2: Configure Security

<p class="note warning"><strong>Warning:</strong> If you are using OpenStack Liberty or Mitaka, do not create the key pair with the OpenStack Horizon dashboard. Instead make sure that you generate the SSH key pair manually. For example, use the <code>ssh-keygen</code> command. Then follow the procedure below to import that key pair into OpenStack. This is due to an <a href="https://bugs.launchpad.net/nova/+bug/1483132">OpenStack bug</a>.</p>

1. In the left navigation of your OpenStack Horizon dashboard, click **Project > Compute > Access & Security**.

1. Select the **Key Pairs** tab on the **Access & Security** page.

1. Click **Import Key Pair**.

1. Enter a **Key Pair Name** and the contents of your public key in the **Public Key** field.

    <%= image_tag("../common/images/openstack/import-key-pair.png", :alt => "Header 'Import Key Pair' is above two columns: name and key text fields on the left and description on the right.") %>


1. Click **Import Key Pair**.

1. In the left navigation, click **Access & Security** to refresh the page. The new key pair appears in the list.

1. Select the **Security Groups** tab. Click **Create Security Group** and create a group with the following properties:
    * **Name**: `opsmanager`
    * **Description**: `<%= vars.ops_manager %>`

    <%= image_tag("../common/images/openstack/create-security.png", :alt => "Header 'Create Security Group' is above two columns: 'Name' and 'Description' text fields on the left and description defining security groups on the right." ) %>

1. Select the checkbox for the `opsmanager` Security Group and click **Manage Rules**.

    <%= image_tag("../common/images/openstack/manage-security-rules.png", :alt => "'opsmanager' is checked in the left-most column of the 'Security Groups' table.") %>

1. Add the following ingress access rules for HTTP, HTTPS, and SSH as shown in the table below. The rules with `opsmanager` in the Remote column have restricted access to that particular Security Group.
    <p class='note'><strong>Note:</strong> Adjust the remote sources as necessary for your own security compliance. <%= vars.company_name %> recommends limiting remote access to <%= vars.ops_manager %> to IP ranges within your organization.</p>

    <table class='nice' border='1'>
      <tr>
        <th><strong>Direction</strong></th>
        <th><strong>Ether Type</strong></th>
        <th><strong>IP Protocol</strong></th>
        <th><strong>Port/Port Range</strong></th>
        <th><strong>Remote</strong></th>
      </tr>
      <tr>
        <td>Ingress</td>
        <td>IPv4</td>
        <td>TCP</td>
        <td>22 (SSH)</td>
        <td>0.0.0.0/0 (CIDR)</td>
      </tr>
      <tr>
        <td>Ingress</td>
        <td>IPv4</td>
        <td>TCP</td>
        <td>80 (HTTP)</td>
        <td>0.0.0.0/0 (CIDR)</td>
      </tr>
      <tr>
        <td>Ingress</td>
        <td>IPv4</td>
        <td>TCP</td>
        <td>443 (HTTPS)</td>
        <td>0.0.0.0/0 (CIDR)</td>
      </tr>
      <tr>
        <td>Ingress</td>
        <td>IPv4</td>
        <td>TCP</td>
        <td>4222 (NATS)</td>
        <td>opsmanager</td>
      </tr>
      <tr>
        <td>Ingress</td>
        <td>IPv4</td>
        <td>TCP</td>
        <td>6868 (BOSH Agent)</td>
        <td>opsmanager</td>
      </tr>
      <tr>
        <td>Ingress</td>
        <td>IPv4</td>
        <td>TCP</td>
        <td>8844 (CredHub)</td>
        <td>opsmanager</td>
      </tr>
      <tr>
        <td>Ingress</td>
        <td>IPv4</td>
        <td>TCP</td>
        <td>8853 (BOSH Health Monitor)</td>
        <td>opsmanager</td>
      </tr>
      <tr>
        <td>Ingress</td>
        <td>IPv4</td>
        <td>TCP</td>
        <td>25250 (BOSH Blobstore)</td>
        <td>opsmanager</td>
      </tr>
      <tr>
        <td>Ingress</td>
        <td>IPv4</td>
        <td>TCP</td>
        <td>25555 (BOSH Director)</td>
        <td>opsmanager</td>
      </tr>
      <tr>
        <td>Ingress</td>
        <td>IPv4</td>
        <td>TCP</td>
        <td>25777 (BOSH Registry)</td>
        <td>opsmanager</td>
      </tr>
      <tr>
        <td>Egress</td>
        <td>IPv4</td>
        <td>TCP</td>
        <td>1-65535</td>
        <td>0.0.0.0/0 (CIDR)</td>
      </tr>
    </table>

1. Leave the existing default egress access rules as shown in the screenshot below.
    <%= image_tag("../common/images/openstack/ingress-egress-rules.png", :alt => "The Egress and Ingress rules table shows its two first egress rules as 'IPv4' and 'IPv6' ether types with an IP protocol and port range of 'any'.") %>


## <a id='validate-openstack'></a> Step 3: (Optional) Run the CF OpenStack Validator Tool

As an optional but recommended step, you can now run the CF OpenStack Validator tool against your OpenStack tenant to verify support for <%= vars.ops_manager %>.

1. Follow the directions for running the [CF OpenStack Validator Tool](https://github.com/cloudfoundry-incubator/cf-openstack-validator).

2. When configuring the CPI version used by the Validator, specify the OpenStack CPI version indicated in the [<%= vars.ops_manager %> Release Notes](../release-notes.html) for the <%= vars.ops_manager %> release that you are planning to deploy.

Troubleshooting the output of the CF OpenStack Validator tool is beyond the scope of this document.

## <a id='create-om-image'></a> Step 4: Create <%= vars.ops_manager %> Image

You can create the <%= vars.ops_manager %> image in OpenStack using the OpenStack Horizon dashboard.

<p class='note'><strong>Note:</strong> If your Horizon Dashboard does not support file uploads, you must use the <a href="https://docs.openstack.org/python-glanceclient/latest/cli/glance.html">Glance CLI</a> client.</p>

To create an <%= vars.ops_manager %> image in OpenStack, perform the following steps:

1. Download the **<%= vars.ops_manager %> for OpenStack** image file from [VMware Tanzu Network](https://network.pivotal.io).

1. In the left navigation of your OpenStack dashboard, click **Project > Compute > Images**.

1. Click **Create Image**. Complete the **Create An Image** page with the following information:
    * **Name**: Enter `<%= vars.ops_manager %>`.
    * **Image Source**: Select **Image File**.
    * **Image File**: Click **Choose File**. Browse to and select the image file
      that you downloaded from [VMware Tanzu Network](https://network.pivotal.io).
    * **Format**: Select **Raw**.
    * **Minimum Disk (GB)**: Enter `80`.
    * **Minimum RAM (MB)**: Enter `8192`.
    * Deselect the **Public** checkbox.
    * Select the **Protected** checkbox.

    <%= image_tag("../common/images/openstack/create-image.png", :alt => "'Create an Image' screen has all fields listed on the left. A description is on the right.") %>

1. Click **Create Image**.


## <a id='launch-om-vm'></a> Step 5: Launch <%= vars.ops_manager %> VM

1. In the left navigation of your OpenStack dashboard, click **Project > Compute > Images**.

1. Click **Launch**.

    <%= image_tag("../common/images/openstack/launch-image.png", :alt => "The 'Images' table has the 'Ops Manager' Image Name enabled. The 'Launch' button is in the right-most cell of the row.") %>

1. In the **Details** tab, specify the following values:
    * **Instance Name**: Enter `<%= vars.ops_manager %>`.
    * **Availability Zone**: Use the dropdown to select an availability zone. You specify this availability zone in the [Complete the Availability Zones Pages](config.html#az-config) step of [Configuring <%= vars.ops_manager %> Director](config.html).
    * **Count**: Do not change from the default value of **1**.
      <%= image_tag("../common/images/openstack/instance-details.png", :alt => "'Launch Instance' screen has 'Details' side-tab highlighted in dark blue. Body has short description and the three fields beneath.") %>

1. In the **Source** tab, specify the following values:
    * **Select Boot Source**: Select **Image**.
    * **Create New Volume**: Leave **No** selected.
    * **Allocated**: Make sure **<%= vars.ops_manager %>** is selected.
      <%= image_tag("../common/images/openstack/instance-source.png", :alt => "The 'Source' side-tab is highlighted. 'Allocated' table has an expandable Ops Manager row highlighted in light gray.") %>

1. In the **Flavor** tab, configure the OpenStack VM flavors as follows:
  <p class="note"><strong>Note:</strong> Do not change the names of the VM flavors.</p>
  <table class='nice' border='1'>
    <tr>
      <th><strong>ID</strong></th>
      <th><strong>Name</strong></th>
      <th><strong>Memory_MB</strong></th>
      <th><strong>Disk</strong></th>
      <th><strong>Ephemeral</strong></th>
      <th><strong>VCPUs</strong></th>
    </tr>
      <tr>
      <td>1</td>
      <td>m1.small</td>
      <td>2048</td>
      <td>20</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <td>2</td>
      <td>m1.medium</td>
      <td>4096</td>
      <td>40</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <td>3</td>
      <td>m1.large</td>
      <td>8192</td>
      <td>80</td>
      <td>0</td>
      <td>4</td>
    </tr>
    <tr>
      <td>4</td>
      <td>m1.xlarge</td>
      <td>16384</td>
      <td>160</td>
      <td>0</td>
      <td>8</td>
    </tr>
  </table>

1. In the **Networks** tab, select a private subnet. You add a Floating IP
   to this network in a later step.
      <%= image_tag("../common/images/openstack/instance-networks.png", :alt => "'Allocated' is an expanded section with a network named 'loam_net'. 'Available' section is expanded with an empty table.") %>

1. Skip the **Network Ports** tab.

1. In the **Security Groups** tab, select the **opsmanager** security group that you created in [Step 2: Configure Security](#security). Deselect all other Security Groups.
    <%= image_tag("../common/images/openstack/instance-security-groups.png", :alt => "'Allocated' is an expanded section that has 'opsmanager' security group in one table row. 'Available' section is expanded and has two rows of other security groups.") %>

1. In the **Key Pair** tab, select the key pair that you imported in [Step 2: Configure Security](#security).
    <%= image_tag("../common/images/openstack/instance-key-pairs.png", :alt => "'Allocated' table has has one key pair while the 'Available' section is expanded with five items. ") %>

1. Skip the **Configuration** and **Metadata** tabs.

1. Click **Launch Instance**. This step starts your new <%= vars.ops_manager %> instance.


## <a id='floating-ip'></a> Step 6: Associate a Floating IP Address

1. In the left navigation of your OpenStack dashboard, click **Project > Compute > Instances**.

1. Wait until the **Power State** of the <%= vars.ops_manager %> instance shows as _Running_.

1. Record the private **IP Address** of the <%= vars.ops_manager %> instance.
    <%= image_tag("../common/images/openstack/instance-running.png", :alt => "'Instances' table shows a single row with Instance name and Image Name of 'Ops Manager'.") %>
  You must provide this IP Address when you perform [Step 6: Complete the Create Networks Page](config.html#create-networks) in <%= vars.ops_manager %>.

1. Select the **<%= vars.ops_manager %>** checkbox. Click the **Actions** dropdown and select **Associate Floating IP**. The **Manage Floating IP Associations** screen appears.
    <%= image_tag("../common/images/openstack/floating-ip-create.png", :alt => "'Managing Floating IP Associations' screen shows 'Ops Manager' selected in the 'Port to be associated' dropdown.") %>

1. Under **IP Address**, click the plus button (**+**). The **Allocate Floating IP** screen appears.

1. Under **Pool**, select an IP Pool and click **Allocate IP**.

    <%= image_tag("../common/images/openstack/floating-ip-allocate.png", :alt => "'Allocate Floating IP' screen shows 'admin_floating_net' selected in 'Pool' dropdown.") %>

1. Under **Port to be associated**, select your **<%= vars.ops_manager %>** instance.

    <%= image_tag("../common/images/openstack/floating-ip-assign.png", :alt => "'Manage Floating IP Associations' screen, 'Ops Manager' is selected for 'Port to be associated.'") %>

1. Click **Associate**.


## <a id='blob-storage'></a> Step 7: Add Blob Storage

1. In the left navigation of your OpenStack dashboard, click **Project > Object Store > Containers**.

1. Click **Create Container**. Create a container with the following properties:
    * **Container Name**: Enter `pcf`.
    * **Container Access**: Leave **public** unselected.

    <%= image_tag("../common/images/openstack/create-container.png", :alt => "'Create Container' screen shows a name in 'Container Name' text field and 'Public' checkbox unselected.") %>

1. Click **Create**.


## <a id='blobstore-creds'></a> Step 8: Download Credentials for S3 Blob Storage

1. In the left navigation of your OpenStack dashboard, click **Project > Compute > Access & Security**. Select the **API Access** tab.

    <%= image_tag("../common/images/openstack/download-credentials.png", :alt => "'Access & Security' screen, an 'API Endpoints' section has a table that lists 'Compute' and 'Network' Services.") %>

1. Click **Download EC2 Credentials**.

1. Unzip the downloaded credentials.

1. If you select **S3 Compatible Blobstore** in your [BOSH Director Config](config.html#director-config), you need the contents of this file to complete the configuration.


## <a id='dns-entry'></a> Step 9: Create a DNS Entry

Create a DNS entry for the floating IP address that you assigned to <%= vars.ops_manager %> in [Step 6: Associate a Floating IP Address](#floating-ip).

You must use this fully qualified domain name when you log into <%= vars.ops_manager %> for the first time.


## <a id='configure-ops'></a> Step 10: Configure BOSH Director for OpenStack

After completing this procedure, complete all of the steps in the [Configuring BOSH Director on OpenStack](config.html) and [Configuring <%= vars.app_runtime_abbr %>](https://docs.pivotal.io/application-service/operating/configure-pas.html).

---

Return to [Installing <%= vars.ops_manager %> on OpenStack](../install/openstack.html).
